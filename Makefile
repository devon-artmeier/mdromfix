# ------------------------------------------------------------------------------
# Commands
# ------------------------------------------------------------------------------

ifeq ($(OS),Windows_NT)
MKDIR                := mkdir
RMDIR                := rmdir /s /q
else
MKDIR                := mkdir -p
RMDIR                := rm -rf
endif

# ------------------------------------------------------------------------------
# Paths
# ------------------------------------------------------------------------------

OUT_PATH             := out
BUILD_PATH           := $(OUT_PATH)/build

OUT_PATH_EXISTS      := $(wildcard $(OUT_PATH))

# ------------------------------------------------------------------------------
# Tool flags
# ------------------------------------------------------------------------------

ifeq ($(OS),Windows_NT)
CMAKE_INSTALL_FLAGS  := --prefix="$(OUT_PATH)"
else
CMAKE_INSTALL_FLAGS  := 
endif

# ------------------------------------------------------------------------------
# Reserved rules
# ------------------------------------------------------------------------------

.PHONY: all install clean

# ------------------------------------------------------------------------------
# Make all
# ------------------------------------------------------------------------------

all: $(OUT_PATH)
	@cmake -S . -B "$(BUILD_PATH)"
	@cmake --build "$(BUILD_PATH)" --config Release

# ------------------------------------------------------------------------------
# Install
# ------------------------------------------------------------------------------

install:
	@cmake --install "$(BUILD_PATH)" --config Release $(CMAKE_INSTALL_FLAGS)

# ------------------------------------------------------------------------------
# Clean
# ------------------------------------------------------------------------------

clean:
ifneq ($(OUT_PATH_EXISTS),)
	@$(RMDIR) "$(OUT_PATH)"
endif

# ------------------------------------------------------------------------------
# Path rules
# ------------------------------------------------------------------------------

$(OUT_PATH):
	@$(MKDIR) "$@"

# ------------------------------------------------------------------------------